%%%-------------------------------------------------------------------
%%% @author Andreas Schultz <aschultz@tpip.net>
%%% @copyright (C) 2011, Andreas Schultz
%%% @doc
%%%
%%% @end
%%% Created : 29 Jun 2011 by Andreas Schultz <aschultz@tpip.net>
%%%-------------------------------------------------------------------
-module(netlink_SUITE).

-compile(export_all).

-include_lib("common_test/include/ct.hrl").
-include("../include/netlink.hrl").

-define(equal(Expected, Actual),
    (fun (Expected@@@, Expected@@@) -> true;
         (Expected@@@, Actual@@@) ->
             ct:pal("MISMATCH(~s:~b, ~s)~nExpected: ~p~nActual:   ~p~n",
                    [?FILE, ?LINE, ??Actual, Expected@@@, Actual@@@]),
             false
     end)(Expected, Actual) orelse error(badmatch)).

% hexstr2bin
hexstr2bin(S) ->
    list_to_binary(hexstr2list(S)).

hexstr2list([X,Y|T]) ->
    [mkint(X)*16 + mkint(Y) | hexstr2list(T)];
hexstr2list([]) ->
    [].

mkint(C) when $0 =< C, C =< $9 ->
    C - $0;
mkint(C) when $A =< C, C =< $F ->
    C - $A + 10;
mkint(C) when $a =< C, C =< $f ->
    C - $a + 10.

%%--------------------------------------------------------------------

conntrack_new() ->
	<<196,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,52,0,1,128,20,0,
      1,128,8,0,1,0,192,168,2,24,8,0,2,0,192,168,2,9,28,0,2,128,5,0,1,0,6,0,0,
      0,6,0,2,0,215,100,0,0,6,0,3,0,0,25,0,0,52,0,2,128,20,0,1,128,8,0,1,0,192,
      168,2,9,8,0,2,0,192,168,2,24,28,0,2,128,5,0,1,0,6,0,0,0,6,0,2,0,0,25,0,0,
      6,0,3,0,215,100,0,0,8,0,12,0,53,230,153,0,8,0,3,0,0,0,1,142,8,0,7,0,0,0,
      0,60,48,0,4,128,44,0,1,128,5,0,1,0,5,0,0,0,5,0,2,0,7,0,0,0,5,0,3,0,7,0,0,
      0,6,0,4,0,55,0,0,0,6,0,5,0,35,0,0,0>>.

rt_newneigh_1() ->
	<<76,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,5,0,0,0,2,0,0,1,
      8,0,1,0,192,168,2,3,10,0,2,0,0,14,12,186,3,162,0,0,8,0,4,0,4,0,0,0,20,0,
      3,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0>>.

rt_newneigh_2() ->
	<<88,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,5,0,0,0,2,0,0,
      1,20,0,1,0,32,1,6,248,18,217,0,0,0,0,0,0,0,0,0,9,10,0,2,0,0,80,86,174,41,
      172,0,0,8,0,4,0,1,0,0,0,20,0,3,0,33,1,0,0,33,1,0,0,0,0,0,0,3,0,0,0>>.

rt_delroute() ->
	<<156,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,10,128,0,0,255,0,0,1,0,
      2,0,0,8,0,15,0,255,0,0,0,20,0,1,0,255,2,0,0,0,0,0,0,0,0,0,0,0,0,0,251,28,
      0,8,0,8,0,2,0,220,5,0,0,8,0,8,0,160,5,0,0,8,0,10,0,255,255,255,255,20,0,
      5,0,255,2,0,0,0,0,0,0,0,0,0,0,0,0,0,251,8,0,4,0,5,0,0,0,8,0,6,0,0,0,0,0,
      36,0,12,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0>>.

rt_newprefix() ->
	<<60,0,0,0,52,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,5,0,0,0,3,64,
      3,0,20,0,1,0,32,1,6,248,18,217,0,0,0,0,0,0,0,0,0,0,12,0,2,0,128,58,9,0,0,
      141,39,0>>.

rt_newlink_1() ->
	<<8,2,0,0,16,0,0,0,0,0,0,0,0,0,0,0,10,0,1,0,6,0,0,0,3,16,
      1,0,0,0,0,0,10,0,3,0,118,108,97,110,52,0,0,0,10,0,1,0,0,25,185,71,250,19,
      0,0,8,0,4,0,220,5,0,0,8,0,5,0,5,0,0,0,192,1,12,0,8,0,1,0,0,0,0,128,20,0,
      5,0,255,255,0,0,108,53,74,4,192,16,0,0,100,0,0,0,120,0,2,0,0,0,0,0,64,0,
      0,0,220,5,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,3,0,0,0,144,1,0,0,100,0,0,
      0,0,0,0,0,128,58,9,0,128,81,1,0,5,0,0,0,88,2,0,0,16,0,0,0,0,0,0,0,1,0,0,
      0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,1,0,0,0,0,0,0,0,252,0,3,0,31,0,0,0,0,0,0,0,80,1,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,80,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,87,1,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,80,1,0,0,0,0,0,0,90,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,111,145,0,0,0,0,0,0,79,147,0,0,0,0,0,0,111,145,0,0,0,0,0,0,71,148,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,44,0,6,0,5,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0>>.

rt_newlink_2() ->
	<<188,1,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,3,16,0,
      0,1,0,0,0,9,0,3,0,101,116,104,49,0,0,0,0,8,0,13,0,232,3,0,0,5,0,16,0,2,0,
      0,0,5,0,17,0,0,0,0,0,8,0,4,0,220,5,0,0,15,0,6,0,112,102,105,102,111,95,
      102,97,115,116,0,0,36,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,239,51,
      0,0,201,255,255,19,0,0,8,0,0,0,0,10,0,1,0,0,80,4,77,115,158,0,0,10,0,2,0,
      255,255,255,255,255,255,0,0,96,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,188,0,23,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,8,0,21,0,0,0,0,0>>.

rt_linkinfo_1() ->
	<<224,1,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,6,0,0,0,2,16,
      0,0,1,0,0,0,10,0,3,0,118,108,97,110,52,0,0,0,8,0,13,0,0,0,0,0,5,0,16,0,2,
      0,0,0,5,0,17,0,0,0,0,0,8,0,4,0,220,5,0,0,8,0,5,0,5,0,0,0,12,0,6,0,110,
      111,113,117,101,117,101,0,36,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,1,0,0,25,185,71,250,19,0,0,10,0,2,0,255,
      255,255,255,255,255,0,0,96,0,7,0,4,15,0,0,137,18,0,0,218,23,6,0,162,97,7,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,188,0,23,0,4,15,0,0,0,0,0,0,137,18,0,0,0,0,0,0,218,23,6,0,0,0,
      0,0,162,97,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,4,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,18,0,9,0,1,0,118,108,97,110,0,
      0,0,0,24,0,2,0,6,0,1,0,4,0,0,0,12,0,2,0,1,0,0,0,255,255,255,255>>.

rt_linkinfo_complex() ->
	<<172,1,0,0,16,0,2,0,0,0,0,0,0,0,255,255,0,0,4,3,1,0,0,0,
      73,0,1,0,0,0,0,0,7,0,3,0,108,111,0,0,8,0,13,0,0,0,0,0,5,0,16,0,0,0,0,0,5,
      0,17,0,0,0,0,0,8,0,4,0,52,64,0,0,12,0,6,0,110,111,113,117,101,117,101,0,
      36,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,10,0,1,0,0,0,0,0,0,0,0,0,10,0,2,0,0,0,0,0,0,0,0,0,96,0,7,0,154,92,1,0,
      154,92,1,0,104,17,195,0,104,17,195,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,188,0,23,0,154,92,1,0,0,0,0,
      0,154,92,1,0,0,0,0,0,104,17,195,0,0,0,0,0,104,17,195,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,180,1,0,0,16,0,2,0,0,0,0,0,0,0,255,255,0,0,1,0,2,0,0,0,67,16,1,0,0,
      0,0,0,9,0,3,0,101,116,104,48,0,0,0,0,8,0,13,0,232,3,0,0,5,0,16,0,6,0,0,0,
      5,0,17,0,0,0,0,0,8,0,4,0,220,5,0,0,7,0,6,0,109,113,0,0,36,0,14,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,10,0,1,0,0,25,
      185,71,250,19,0,0,10,0,2,0,255,255,255,255,255,255,0,0,96,0,7,0,102,121,
      128,3,212,26,211,2,107,193,223,78,153,82,28,229,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,224,110,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,188,0,23,0,
      102,121,128,3,0,0,0,0,212,26,211,2,0,0,0,0,107,193,223,78,12,0,0,0,153,
      82,28,229,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,224,110,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,21,0,0,0,0,0,188,1,0,0,16,0,2,
      0,0,0,0,0,0,0,255,255,0,0,1,0,3,0,0,0,3,16,0,0,0,0,0,0,9,0,3,0,101,116,
      104,49,0,0,0,0,8,0,13,0,232,3,0,0,5,0,16,0,2,0,0,0,5,0,17,0,0,0,0,0,8,0,
      4,0,220,5,0,0,15,0,6,0,112,102,105,102,111,95,102,97,115,116,0,0,36,0,14,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,1,
      0,0,14,12,195,185,27,0,0,10,0,2,0,255,255,255,255,255,255,0,0,96,0,7,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,188,0,23,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,21,0,0,0,0,0,
      192,1,0,0,16,0,2,0,0,0,0,0,0,0,255,255,0,0,1,0,4,0,0,0,67,16,1,0,0,0,0,0,
      9,0,3,0,116,97,112,48,0,0,0,0,8,0,13,0,244,1,0,0,5,0,16,0,0,0,0,0,5,0,17,
      0,0,0,0,0,8,0,4,0,220,5,0,0,15,0,6,0,112,102,105,102,111,95,102,97,115,
      116,0,0,36,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,10,0,1,0,210,248,143,101,242,239,0,0,10,0,2,0,255,255,255,255,
      255,255,0,0,96,0,7,0,180,7,0,0,203,163,20,0,177,50,5,0,124,220,111,11,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,188,0,23,0,180,7,0,0,0,0,0,0,203,163,20,0,0,0,0,0,177,50,5,0,0,0,0,
      0,124,220,111,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,18,0,8,0,1,0,116,117,110,0,
      172,1,0,0,16,0,2,0,0,0,0,0,0,0,255,255,0,0,1,0,5,0,0,0,67,16,1,0,0,0,0,0,
      8,0,3,0,98,114,48,0,8,0,13,0,0,0,0,0,5,0,16,0,0,0,0,0,5,0,17,0,0,0,0,0,8,
      0,4,0,220,5,0,0,12,0,6,0,110,111,113,117,101,117,101,0,36,0,14,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,1,0,0,25,
      185,71,250,19,0,0,10,0,2,0,255,255,255,255,255,255,0,0,96,0,7,0,130,41,
      86,2,238,191,6,2,188,192,107,206,93,73,7,165,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,15,195,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,188,0,23,0,130,
      41,86,2,0,0,0,0,238,191,6,2,0,0,0,0,188,192,107,206,11,0,0,0,93,73,7,165,
      6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      15,195,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,1,0,0,16,0,2,0,0,0,0,0,0,0,255,255,0,0,1,
      0,6,0,0,0,2,16,0,0,0,0,0,0,10,0,3,0,118,108,97,110,52,0,0,0,8,0,13,0,0,0,
      0,0,5,0,16,0,2,0,0,0,5,0,17,0,0,0,0,0,8,0,4,0,220,5,0,0,8,0,5,0,5,0,0,0,
      12,0,6,0,110,111,113,117,101,117,101,0,36,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,1,0,0,25,185,71,250,19,0,0,
      10,0,2,0,255,255,255,255,255,255,0,0,96,0,7,0,4,15,0,0,137,18,0,0,218,23,
      6,0,162,97,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,15,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,188,0,23,0,4,15,0,0,0,0,0,0,137,18,0,0,0,0,0,0,
      218,23,6,0,0,0,0,0,162,97,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,18,0,9,0,1,0,
      118,108,97,110,0,0,0,0,24,0,2,0,6,0,1,0,4,0,0,0,12,0,2,0,1,0,0,0,255,255,
      255,255,224,1,0,0,16,0,2,0,0,0,0,0,0,0,255,255,0,0,1,0,7,0,0,0,67,16,1,0,
      0,0,0,0,12,0,3,0,118,108,97,110,49,48,49,0,8,0,13,0,0,0,0,0,5,0,16,0,6,0,
      0,0,5,0,17,0,0,0,0,0,8,0,4,0,220,5,0,0,8,0,5,0,5,0,0,0,12,0,6,0,110,111,
      113,117,101,117,101,0,36,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,10,0,1,0,0,25,185,71,250,19,0,0,10,0,2,0,255,255,
      255,255,255,255,0,0,96,0,7,0,0,0,0,0,129,3,0,0,0,0,0,0,162,155,1,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,188,0,23,0,0,0,0,0,0,0,0,0,129,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,162,155,1,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,18,0,9,0,1,0,118,108,97,110,0,0,0,0,24,0,
      2,0,6,0,1,0,101,0,0,0,12,0,2,0,1,0,0,0,255,255,255,255,224,1,0,0,16,0,2,
      0,0,0,0,0,0,0,255,255,0,0,1,0,8,0,0,0,67,16,1,0,0,0,0,0,12,0,3,0,118,108,
      97,110,49,48,51,0,8,0,13,0,0,0,0,0,5,0,16,0,6,0,0,0,5,0,17,0,0,0,0,0,8,0,
      4,0,220,5,0,0,8,0,5,0,5,0,0,0,12,0,6,0,110,111,113,117,101,117,101,0,36,
      0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      10,0,1,0,0,25,185,71,250,19,0,0,10,0,2,0,255,255,255,255,255,255,0,0,96,
      0,7,0,0,0,0,0,128,3,0,0,0,0,0,0,87,155,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,188,0,23,0,0,0,0,0,0,0,
      0,0,128,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,87,155,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      40,0,18,0,9,0,1,0,118,108,97,110,0,0,0,0,24,0,2,0,6,0,1,0,103,0,0,0,12,0,
      2,0,1,0,0,0,255,255,255,255>>.

nfq_unbind() ->
    <<28,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,1,0,4,0,0,2>>.
nfq_unbind_answer() ->
    <<36,0,0,0,2,0,0,0,0,0,0,0,174,4,0,0,0,0,0,0,28,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0>>.

nfq_bind_queue() ->
    <<28,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,1,0,3,0,0,2>>.

nfq_bind_queue_answer() ->
    <<36,0,0,0,2,0,0,0,0,0,0,0,189,4,0,0,0,0,0,0,28,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0>>.

nfq_bind_socket() ->
    <<28,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,1,0,1,0,0,0>>.

nfq_bind_socket_answer() ->
    <<36,0,0,0,2,0,0,0,0,0,0,0,189,4,0,0,0,0,0,0,28,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0>>.

nfq_set_copy_mode() ->
    <<32,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,2,0,0,0,255,255,2,0,0,0>>.

nfq_set_copy_mode_answer() ->
    <<36,0,0,0,2,0,0,0,0,0,0,0,189,4,0,0,0,0,0,0,32,0,0,0,2,3,5,0,0,0,0,0,0,0,0,0>>.

nfq_set_verdict() ->
    <<32,0,0,0,1,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,2,0,0,0,0,1,0,0,0,1>>.

nfq_packet() ->
    <<176,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,2,0,0,0,11,0,1,0,0,0,
      0,1,8,0,0,0,8,0,5,0,0,0,0,11,8,0,3,0,8,12,0,0,16,0,9,0,
      0,6,0,0,0,80,86,150,196,3,0,0,20,0,4,0,0,0,0,0,85,167,
      197,137,0,0,0,0,0,10,209,138,92,0,10,0,69,192,0,88,87,
      34,0,0,1,89,213,56,172,28,0,17,224,0,0,5,2,1,0,52,172,
      28,0,17,0,0,0,0,0,0,0,2,0,0,1,16,0,7,94,156,255,255,255,
      0,0,10,2,1,0,0,0,40,172,28,0,17,172,28,0,32,10,0,0,1,
      172,28,0,16,231,148,79,84,211,63,84,12,100,46,35,199,
      185,157,63,9>>.

nft_requests() ->
    [hexstr2bin("1400000010000100000000000000000002000a0014000000090a050001000000"
		"00000000020000001400000011000100020000000000000002000a00"),
     hexstr2bin("14000000100a0100030000000000000000000000"),
     hexstr2bin("14000000010a0103050000000000000000000000"),
     hexstr2bin("1c000000010a05000500000000000000020000000800010072617700"),
     hexstr2bin("1c0000000a0a05030500000000000000020000000800010072617700"),
     hexstr2bin("14000000040a0103050000000000000002000000"),
     hexstr2bin("14000000070a0103050000000000000002000000"),
     hexstr2bin("20000000010a05000500000000000000020000000b0001006d616e676c650000"),
     hexstr2bin("200000000a0a05030500000000000000020000000b0001006d616e676c650000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b0001006d616e676c650000"
		"090002006d61703000000000"),
     hexstr2bin("14000000040a0103050000000000000002000000"),
     hexstr2bin("14000000070a0103050000000000000002000000"),
     hexstr2bin("30000000000b0500f5c0c15500000000020000000b000100736f636b65740000"
		"08000200000000020800030000000000"),
     hexstr2bin("30000000000b0500f5c0c15500000000020000000b000100736f636b65740000"
		"08000200000000020800030000000000"),
     hexstr2bin("2c000000000b0500f5c0c1550000000002000000080001007365740008000200"
		"000000040800030000000000"),
     hexstr2bin("2c000000000b0500f5c0c1550000000002000000080001007365740008000200"
		"000000040800030000000000"),
     hexstr2bin("2c000000000b0500f5c0c1550000000002000000080001007365740008000200"
		"000000040800030000000000"),
     hexstr2bin("2c000000000b0500f5c0c1550000000002000000080001007365740008000200"
		"000000040800030000000000"),
     %% RTM_GETLINK
     %% hexstr2bin("1400000012000103f5c0c1550000000011000000"),
     hexstr2bin("1c000000010a0500050000000000000002000000080001006e617400"),
     hexstr2bin("1c0000000a0a0503050000000000000002000000080001006e617400"),
     hexstr2bin("14000000040a0103050000000000000002000000"),
     hexstr2bin("14000000070a0103050000000000000002000000"),
     hexstr2bin("20000000010a05000500000000000000020000000b00010066696c7465720000"),
     hexstr2bin("200000000a0a05030500000000000000020000000b00010066696c7465720000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703000000000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703100000000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703200000000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703300000000"),

     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703400000000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703500000000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703600000000"),
     hexstr2bin("2c0000000d0a05030500000000000000020000000b00010066696c7465720000"
		"090002006d61703700000000"),
     hexstr2bin("14000000040a0103050000000000000002000000"),
     hexstr2bin("14000000070a0103050000000000000002000000")].

genl_request() ->
    hexstr2bin("240000001000050077ce08560000000003010000060001001000000008000200"
	       "67747000").

%%--------------------------------------------------------------------
%% @spec suite() -> Info
%% Info = [tuple()]
%% @end
%%--------------------------------------------------------------------
suite() ->
	[{timetrap,{seconds,30}}].

test_conntrack_new(_Config) ->
	Msg = conntrack_new(),
	Msg = netlink:nl_ct_enc(netlink:nl_ct_dec(Msg)),
    ok.

test_rt_newneigh_1(_Config) ->
	Msg = rt_newneigh_1(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_rt_newneigh_2(_Config) ->
	Msg = rt_newneigh_2(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_rt_delroute(_Config) ->
	Msg = rt_delroute(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_rt_newprefix(_Config) ->
	Msg = rt_newprefix(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_rt_newlink_1(_Config) ->
	Msg = rt_newlink_1(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_rt_newlink_2(_Config) ->
	Msg = rt_newlink_2(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_rt_linkinfo_1(_Config) ->
	Msg = rt_linkinfo_1(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_rt_linkinfo_complex(_Config) ->
	Msg = rt_linkinfo_complex(),
	Msg = netlink:nl_rt_enc(netlink:nl_rt_dec(Msg)),
    ok.

test_nfq_unbind(_Config) ->
    Msg = nfq_unbind(),
    Msg = netlink:nl_ct_enc(netlink:nl_ct_dec(Msg)),
    ok.

test_nfq_bind_queue(_Config) ->
    Msg = nfq_bind_queue(),
    Msg = netlink:nl_ct_enc(netlink:nl_ct_dec(Msg)),
    ok.

test_nfq_bind_socket(_Config) ->
    Msg = nfq_bind_socket(),
    Msg = netlink:nl_ct_enc(netlink:nl_ct_dec(Msg)),
    ok.

test_nfq_set_copy_mode(_Config) ->
    Msg = nfq_set_copy_mode(),
    Msg = netlink:nl_ct_enc(netlink:nl_ct_dec(Msg)),
    ok.

test_nfq_set_verdict(_Config) ->
    Msg = nfq_set_verdict(),
    Msg = netlink:nl_ct_enc(netlink:nl_ct_dec(Msg)),
    ok.

test_nft_requests(_Config) ->
    lists:foreach(fun(Msg) ->
			  D = netlink:nl_ct_dec(Msg),
			  ct:pal("D: ~p", [D]),
			  ?equal(Msg, netlink:nl_ct_enc(D))
		  end, nft_requests()),
    ok.

test_genl(_Config) ->
    Msg = genl_request(),
    Msg = netlink:nl_enc(?NETLINK_GENERIC, netlink:nl_dec(?NETLINK_GENERIC, Msg)),
    ok.

all() ->
	[test_conntrack_new,
	 test_rt_newneigh_1, test_rt_newneigh_2, test_rt_delroute,
	 test_rt_newprefix,
	 test_rt_newlink_1, test_rt_newlink_2,
	 test_rt_linkinfo_1, test_rt_linkinfo_complex,
	 test_nfq_unbind, test_nfq_bind_queue,
	 test_nfq_bind_socket, test_nfq_set_copy_mode,
	 test_nfq_set_verdict,
	 test_nft_requests,
	 test_genl
	].

init_per_suite(Config) ->
	R = netlink:start(),
	Config.

end_per_suite(_Config) ->
	ok.

